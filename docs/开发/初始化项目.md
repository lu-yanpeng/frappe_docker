## 创建frappe项目

创建一个frappe的开发环境，会在当前目录下创建demo文件夹，里面就是frappe的项目

```shell
bench init --skip-redis-config-generation demo
```

`skip-redis-config-generation`参数表示跳过redis的配置，使用`common-site-config.json`中的配置。如果在容器里开发，需要手动到`common-site-config.json`里面修改redis的配置

## 配置数据库地址

打开`common-site-config.json`修改这些配置，在容器里数据库地址就是容器的名字，使用容器名来通信。在本机环境就可以填ip地址

```json
{
  "db_host": "mariadb",
  "redis_cache": "redis://redis-cache:6379",
  "redis_queue": "redis://redis-queue:6379",
  "redis_socketio": "redis://redis-queue:6379",
  "developer_mode": true,
  "server_script_enabled": true
}
```

## 创建应用

在frappe项目里执行这个命令，会在`apps`目录下创建一个`library_management`应用。创建的时候需要填写一些信息，会保存到应用的`pyproject.toml`里面。

```shell
bench new-app library_management
```

`apps`里面默认有一个`frappe`应用，整个项目都基于这个应用来构建

## 创建站点

创建可以被浏览器访问的站点，创建的时候需要提供数据库的root密码，容器环境可以在docker-compose.yml里找到这个密码。还要设置`Administrator`的密码，首次登录的时候需要用Administrator登录

> 注意：站点名字必须以`.localhost`结尾

```shell
bench new-site --mariadb-user-host-login-scope=% library.localhost
```

`mariadb-user-host-login-scope`指定这个数据库用户的Host字段为%，表示可以从任意ip登录用户。容器重启后ip可能会变，如果容器里的ip和用户host对不上就不能登录，因为数据库没有暴露接口外部无法访问，所以可以直接使用%，然后通过容器名连接数据库

创建站点之后就可以在浏览器访问`library.localhost:8000`看到这个站点了，这个`library.localhost`就是站点文件夹的名字，通过文件路由来访问

因为`library.localhost`是运行在`127.0.0.1`的服务，所以需要修改系统的hosts配置，让这个地址指向本机，[参考](https://docs.frappe.io/framework/user/en/tutorial/create-a-site#access-site-in-your-browser)

windows系统可以在`C:\Windows\System32\drivers\etc\hosts`修改地址

## 安装应用

为一个站点安装应用，这里就为library.localhost站点安装了library_management应用，用library_management就可以管理这个站点的行为

```shell
bench --site library.localhost install-app library_management
```

查看站点已安装的应用

```shell
bench --site library.localhost list-apps
```

## 开发模式

打开开发者模式，修改doctype的时候会自动保存到代码中

```shell
bench set-config -g developer_mode true
```

或者直接在`common_site_config.json`里面修改developer_mode为true也可以打开开发模式

## 启用服务器脚本

也可以直接在`common_site_config.json`修改server_script_enabled=true

```shell
bench set-config -g server_script_enabled true
```

## 创建doctype

在管理页面选择`构建 -> 单据类型`可以创建或修改doctype，或者直接在右上角搜索'单据类型'

> 创建的时候一定要在doctype的设置里面取消模块的自定义，否则本地代码中不会生成doctype，如果不能取消可以重启服务器试试
